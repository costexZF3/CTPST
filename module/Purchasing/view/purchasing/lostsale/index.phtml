<?php     
    /*getting values */
       
    $this->headTitle('Lost Sales: Quoted Items no Stock no Order');	
    $this->mainMenu()->setActiveItemId('lostsales'); 
   
    $this->pageBreadcrumbs()->setItems([
        'Home'=>$this->url('home'),
        'Lost Sales'=>$this->url('lostsales')       
        ]);       
    
    //*** getting params from IndexAction() inside LostsaleController 
    $user = $this->user;
    $specialAccess = $this->specialAccess;
    $lostSales = $this->lostsalelist;     
 ?>  
 	
 
<script language="JavaScript">      
                  
    /*
     * this function crea a new array of Elements on the web
     * @param {List} classElement
     * @returns {[]}
     */
    const createArrayFromNodeList = ( nodeList )=> {
      var myArrayFromNodeList = []; // empty at first  
      for (var i = 0; i < nodeList.length; i++) {
            myArrayFromNodeList.push(nodeList[i]); // ahhh, push it            
        }  
        
      return myArrayFromNodeList;
    };
    
        
    const getTimesQuote =( tq )=> {
        let color = "";
        var NodeList = [];
        
        switch (tq ){
            case 'tq100plus' :                 
                hideElement('tq50plus'); hideElement('tq30plus'); hideElement('tq10plus'); hideElement('tq5plus');                
                
                color = "#E6CAE6";
                
                //hide all items with class under tq50plus
                showElement('tq100plus'); 
                
                /* changing color to Elements for being redered */
                NodeList['tq100plus'] = queryAllElement('.tq100plus');
                NodeList['tq100plus'].forEach(item=>{ changeBackgrounColor(item, color);});                
            break;
            
            case 'tq50plus' :                 
                //hide all items with class under tq50plus
                hideElement('tq30plus'); hideElement('tq10plus'); hideElement('tq5plus');
                
                color = "#ffff80"; 
                
                //Show elements with classes: tq100plus and tq50plus                
                showElement('tq100plus'); showElement('tq50plus'); 
                
                NodeList['tq50plus'] = queryAllElement('.tq50plus');
                
                //change background color                
                 NodeList['tq50plus'].forEach(item=>{ changeBackgrounColor(item, color);});
                 NodeList['tq100plus'].forEach(item=>{ changeBackgrounColor(item, color);});                  
            break;
            
            case 'tq30plus' :
                
                //hide all items with class under tq30plus                
                hideElement('tq10plus'); hideElement('tq5plus');
                
                /* background color for elements with class: tq30plus*/
                color = "#CDCD6E";                 
                
                showElement('tq100plus'); showElement('tq50plus'); showElement('tq30plus'); 
                
                NodeList['tq30plus'] = queryAllElement('.tq30plus');
                
                //change background color                
                NodeList['tq30plus'].forEach(item=>{ changeBackgrounColor(item, color);});
                NodeList['tq50plus'].forEach(item=>{ changeBackgrounColor(item, color);});
                NodeList['tq100plus'].forEach(item=>{ changeBackgrounColor(item, color);});
            break;
            
            case 'tq10plus': 
                //hide all items with class under tq10plus                
                hideElement('tq5plus');
                
                /* background color for elements with class: tq10plus*/
                color = "#CAE6E6";                 
                
                /* rendering elements */
                showElement('tq100plus'); showElement('tq50plus'); showElement('tq30plus'); showElement('tq10plus'); 
                
                NodeList['tq10plus'] = queryAllElement('.tq10plus');
                
                //change background color                
                 NodeList['tq10plus'].forEach(item=>{ changeBackgrounColor(item, color);});
                 NodeList['tq30plus'].forEach(item=>{ changeBackgrounColor(item, color);});
                 NodeList['tq50plus'].forEach(item=>{ changeBackgrounColor(item, color);});
                 NodeList['tq100plus'].forEach(item=>{ changeBackgrounColor(item, color);});
            break;
                
            default:
                color = "#dfff80";
            break;
        }; /* end case */                    
    };  
        
    /**
     * @param {string} timesQ  : (it could have the following values: tq100plus, tq50plus, tq30plus, tq10plus)
     * @returns {undefined}
     */
    const timesQuote = (timesQ) =>{ getTimesQuote( timesQ );}; 

   /* getting all parts from screen */
    const fillArray_partsLostSales = ()=> {
            
    };

    /*
     * JQuery code:
     * This occurs when the page has finished to load
    */    
    
    $(document).ready( function(){ 
           //------------------ function to convert to EXCEL FILE THE LOGGED CONTENT TO SCREEN ---------------------------------------- 
        $("#convert").click( function() {
            convertToExcel('LostSales','lost sales');
        });
         
        /* hidding all Elements with less than 100 times quotes*/ 
        hideElement('tq50plus');
        hideElement('tq30plus');
        hideElement('tq10plus');
        hideElement('tq5plus');
       
        /* call a function which it  fills an array with items rendered on the screen */
         //const LostSales = fillArray_partsLostSales();
        }); 

</script>
        
<!-- HTML RENDER-->

<?php if ($specialAccess): ?>
<h1 class="ctp_title"> Quoted Items no Stock no Order (LostSales) </h1>
   <div class ="">
        <div class = "box-buttons row">
            <div class="col-md-offset-2 col-md-6">   
                <p> Please select your preferred Times Quotes[10+, 30+, 50+, 100+]: </p>
                <form>
                    <div class="">
                            <input onclick="timesQuote('tq10plus')" type="radio" name="timesquote" id="tqr10" required >
                            <label for="tqr10">10+</label>


                            <input onclick="timesQuote('tq30plus')" type="radio" name="timesquote" id="tqr30" required>
                            <label for="tqr30">30+</label>


                            <input onclick="timesQuote('tq50plus')" type="radio" name="timesquote" id="tqr50" required>
                            <label for="tqr50">50+</label>

                            <input onclick="timesQuote('tq100plus')"type="radio" name="timesquote" id="tqr100" required>
                            <label for="tqr100">100+</label>
                    </div>                
                </form>
            </div>            
        </div>
       <div class="row">
            <div class="col-sm-12">
                <input class="btn btn-info" id="convert" type="button" name="btnexcel" value="Convert to Excel">
                <input class="btn btn-danger" id="topdf" type="button" name="btnpdf" value="Convert to PDF">
            </div>
        </div>
   <div>
<?php endif; ?>

<table class="table_ctp table_filter display " id="table_toexcel">
     <thead>
         <tr> 
             <th>Part Number </th>
             <th>Description </th>
             <th>Description 2</th>
             <th>Description 3 </th>                
             <th>Qty Quote </th>
             <th>Times Quote </th>
             <th>Custs. Quote</th>
             <th>Sales Las 12</th>
             <th>Vendor NO.</th>
             <th>Vendor Name</th>
             <th>Pur. Agent</th>
             <th>Caterpillar (P/L)</th>
             <th>Wish List</th>
             <th>Dev. Proj</th>
             <th>Dev. Status</th>
             <th>Loc.20</th>
             <th>OEM VND</th>
             <th>Mayor</th> 
             <th>Category</th>
             <th>Minor</th>
             <th>Description</th>
         </tr>
     </thead>
     <tbody>          
        <?php $iteration = 1; 
        
             foreach ($lostSales as $list){   
                 
                 if (trim($list->VENDOR)=="" || trim($list->VENDOR)=="000000" ){ continue; }
                 
                 $className="tq5plus";    
                //code snippet to add a sort of classification to the row
                $timesQuotes = $list->TIMESQ;
                
                /* clasifying all rows of the table according the times quotes: */
                if ( $timesQuotes >= 100 ){
                    $className="tq100plus";  
                } else if ( $timesQuotes >= 50 ){
                    $className="tq50plus";
                } else if ( $timesQuotes >= 30 ){
                    $className="tq30plus";
                } else if ( $timesQuotes >= 10 ){
                    $className="tq10plus";
                }           
             ?>
                <tr class="<?=$className;?>">                 
                    <td class="partnumber"><?=$list->IMPTN;?></td> <!-- PART NUMBER -->              
                    <td class="description"><?=$list->IMDSC;?></td>        <!-- DESCRIPTION -->
                    <td class="description"><?=$list->IMDS2;?></td> <!--DESCRIPTION 2 -->
                    <td class="description"><?=$list->IMDS3;?></td>        <!-- DESCRIPTION 3 -->
                    <td><?=($list->TQUOTE)??0;?></td>  <!-- QUANTITY QUOTE  -->
                    <td class="timesq" id="tq<?=$iteration?>"><?=($list->TIMESQ)??0;?></td>  <!-- TIMES QUOTE  -->
                    <td><?=($list->NCUS)??0;?></td>    <!-- CUSTOMERS QUOTE  -->
                    <td><?=($list->QTYSOLD)??0;?></td> <!-- CUSTOMERS QUOTE  -->
                    <td><?=($list->VENDOR)??'N/A';?></td>  <!-- VENDOR NUMBER  -->                    
                    <td>---</td>  <!-- VENDOR NAME  -->
                    <td>--</td>  <!-- PURCHASING AGENT NAME  -->
                    <td class="money">$<?=(floatval($list->IMPRC))??0;?></td>  <!-- PRICE LIST CATERPILLAR  -->
                    <td>--</td>  <!-- WISH LIST  -->
                    <td>--</td>  <!-- DEVELOPMENT PROJECT  -->
                    <td>--</td>  <!-- DEVELOPMENT STATUS  -->                    
                    <td><?=($list->F20)??0;?></td>          <!-- LOCATION 20  -->
                    <td><?=($list->FOEM)??0;?></td>         <!-- OEM VND  -->
                    <td><?=($list->IMPC1)??0;?></td>        <!-- MAYOR  -->
                    <td><?=($list->IMCATA)??0;?></td>       <!-- CATEGORY  -->
                    <td><?=($list->IMPC2)??0;?></td>        <!-- MINOR  -->
                    <td class="description"><?=($list->mindsc)??"N/A";?></td>   <!-- MINOR DESCRIPTION -->   
                <tr>                
         <?php
            $iteration++;
           
            }; 
         ?> 
     </tbody>
     <tfoot>
         <tr id="countItem_<?=$iteration?>"> 
             <td>Part Number </td>
             <td>Description </td>
             <td> Description 2</td>
             <td>Description 3</td>                
             <td>Qty Quote </td>
             <td>Times Quote </td>
             <td>Custs. Quote</td>
             <td>Sales Las 12</td>
             <td>Vendor NO.</td>
             <td>Vendor Name</td>
             <td>Pur. Agent</td>
             <td>Caterpillar (P/L)</td>
             <td>Wish List</td>
             <td>Dev. Proj</td>
             <td>Dev. Status</td>
             <td>Loc.20</td>
             <td>OEM VND</td>
             <td>Mayor</td> 
             <td>Category</td>
             <td>Minor</td>
             <td>Description</td>
         </tr>
     </tfoot>
 </table>

